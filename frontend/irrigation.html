<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Irrigation Planning - AgriFusion</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(
            rgba(30, 60, 30, 0.85),
            rgba(20, 40, 20, 0.9)
          ),
          url("https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=1650&q=80")
            no-repeat center center fixed;
        background-size: cover;
        color: #fff;
        overflow-x: hidden;
        min-height: 100vh;
      }

      /* Header */
      .header {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .back-btn {
        background: #f44336;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s;
      }

      .back-btn:hover {
        background: #d32f2f;
        transform: scale(1.05);
      }

      .header h1 {
        color: #ffeb3b;
        font-size: 28px;
      }

      /* Container */
      .container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 30px;
      }

      /* Crop Info Banner */
      .crop-banner {
        background: linear-gradient(135deg, #2196f3, #42a5f5);
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4);
      }

      .crop-banner h2 {
        font-size: 28px;
        margin-bottom: 10px;
        color: #fff;
      }

      .crop-banner p {
        font-size: 16px;
        color: #e3f2fd;
      }

      /* Section */
      .section {
        background: rgba(255, 255, 255, 0.12);
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        backdrop-filter: blur(8px);
        border: 2px solid rgba(255, 235, 59, 0.2);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      }

      .section h3 {
        color: #ffd54f;
        font-size: 24px;
        margin-bottom: 20px;
        border-bottom: 2px solid #ffeb3b;
        padding-bottom: 10px;
      }

      /* Irrigation Methods Grid */
      .methods-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .method-card {
        background: rgba(255, 255, 255, 0.08);
        padding: 25px;
        border-radius: 12px;
        border-left: 4px solid #2196f3;
        transition: all 0.3s;
      }

      .method-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(33, 150, 243, 0.4);
        border-color: #42a5f5;
      }

      .method-card h4 {
        color: #42a5f5;
        font-size: 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .method-card p {
        color: #e0e0e0;
        line-height: 1.8;
        margin: 10px 0;
      }

      .badge {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
        margin-top: 10px;
      }

      .badge.recommended {
        background: #4caf50;
        color: white;
      }

      .badge.efficient {
        background: #2196f3;
        color: white;
      }

      /* Water Source Info */
      .water-info {
        background: rgba(33, 150, 243, 0.15);
        border: 2px solid #2196f3;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
      }

      .water-info h4 {
        color: #42a5f5;
        margin-bottom: 15px;
        font-size: 18px;
      }

      .water-info ul {
        padding-left: 25px;
        color: #e0e0e0;
        line-height: 2;
      }

      /* Tips Box */
      .tips-box {
        background: rgba(76, 175, 80, 0.15);
        border: 2px solid #4caf50;
        padding: 25px;
        border-radius: 12px;
        margin-top: 20px;
      }

      .tips-box h4 {
        color: #4caf50;
        margin-bottom: 15px;
        font-size: 20px;
      }

      .tips-box ul {
        padding-left: 25px;
        color: #e0e0e0;
        line-height: 2;
      }

      /* Modern Methods */
      .modern-methods {
        background: linear-gradient(
          135deg,
          rgba(156, 39, 176, 0.2),
          rgba(123, 31, 162, 0.2)
        );
        border: 2px solid rgba(156, 39, 176, 0.4);
        padding: 25px;
        border-radius: 12px;
        margin-top: 30px;
      }

      .modern-methods h4 {
        color: #ba68c8;
        margin-bottom: 15px;
        font-size: 20px;
      }

      .modern-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .modern-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 8px;
        border-left: 3px solid #ba68c8;
      }

      .modern-item h5 {
        color: #ba68c8;
        margin-bottom: 8px;
      }

      .modern-item p {
        color: #e0e0e0;
        font-size: 14px;
        line-height: 1.6;
      }

      /* Loading */
      .loading {
        text-align: center;
        padding: 40px;
        color: #ffeb3b;
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          gap: 15px;
        }

        .methods-grid,
        .modern-grid {
          grid-template-columns: 1fr;
        }

        .container {
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <a href="stages.html" class="back-btn">‚Üê Back to Stages</a>
      <h1>üíß Irrigation Planning</h1>
      <div style="width: 120px"></div>
    </div>

    <!-- Main Container -->
    <div class="container">
      <!-- Crop Banner -->
      <div class="crop-banner" id="cropBanner">
        <div class="loading">Loading your farm information...</div>
      </div>

      <!-- Recommended Irrigation Methods -->
      <div class="section">
        <h3>üí¶ Recommended Irrigation Methods</h3>
        <div id="methodsContent" class="methods-grid">
          <div class="loading">Loading recommendations...</div>
        </div>
      </div>

      <!-- Water Source Based Recommendations -->
      <div class="section">
        <h3>üö∞ Based on Your Water Source</h3>
        <div id="waterSourceContent">
          <div class="loading">Loading...</div>
        </div>
      </div>

      <!-- Best Practices -->
      <div class="section">
        <h3>üå± Crop-Specific Irrigation Practices</h3>
        <div id="practicesContent">
          <div class="loading">Loading...</div>
        </div>
      </div>

      <!-- Modern Irrigation Technologies -->
      <div class="section">
        <div class="modern-methods">
          <h4>üöÄ Modern Irrigation Technologies</h4>
          <div class="modern-grid">
            <div class="modern-item">
              <h5>Smart Irrigation Systems</h5>
              <p>
                IoT-based sensors automatically adjust water based on soil
                moisture levels
              </p>
            </div>
            <div class="modern-item">
              <h5>Drip Irrigation</h5>
              <p>Save up to 60% water by delivering directly to plant roots</p>
            </div>
            <div class="modern-item">
              <h5>Sprinkler Systems</h5>
              <p>Uniform water distribution ideal for large fields</p>
            </div>
            <div class="modern-item">
              <h5>Rain Water Harvesting</h5>
              <p>Collect and store rainwater for sustainable irrigation</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const username = localStorage.getItem("username");

      if (!username) {
        alert("‚ö†Ô∏è Please login first!");
        window.location.href = "login.html";
      }

      let farmerData = null;

      // Irrigation data for different crops
      const irrigationData = {
        Rice: {
          methods: [
            {
              name: "Flood Irrigation",
              description:
                "Traditional method maintaining 2-3 inches of standing water. Best for rice paddies.",
              efficiency: "Low (50-60%)",
              recommended: true,
            },
            {
              name: "Alternate Wetting and Drying (AWD)",
              description:
                "Modern water-saving technique reducing water use by 25-30% without yield loss.",
              efficiency: "High (70-80%)",
              recommended: true,
            },
          ],
          practices: [
            "Maintain 2-3 inch water level during vegetative stage",
            "Drain field 10 days before harvest",
            "Apply water immediately after transplanting",
            "Keep soil saturated but not flooded during reproductive stage",
          ],
        },
        Wheat: {
          methods: [
            {
              name: "Sprinkler Irrigation",
              description:
                "Uniform water distribution ideal for wheat fields. Water-efficient method.",
              efficiency: "High (75-85%)",
              recommended: true,
            },
            {
              name: "Border/Check Basin",
              description:
                "Surface irrigation dividing field into basins. Cost-effective for flat lands.",
              efficiency: "Medium (60-70%)",
              recommended: false,
            },
          ],
          practices: [
            "Irrigate at critical stages: Crown root initiation (20-25 days), Tillering, Flowering, Grain filling",
            "Avoid water logging - wheat is sensitive to excess water",
            "Light irrigation during germination phase",
            "Stop irrigation 10-15 days before harvest",
          ],
        },
        Maize: {
          methods: [
            {
              name: "Drip Irrigation",
              description:
                "Most efficient for maize. Delivers water directly to root zone.",
              efficiency: "Very High (90-95%)",
              recommended: true,
            },
            {
              name: "Furrow Irrigation",
              description:
                "Water flows through furrows between crop rows. Traditional method.",
              efficiency: "Medium (60-70%)",
              recommended: false,
            },
          ],
          practices: [
            "Critical stages: Germination, Tasseling, Silking, Grain filling",
            "Avoid water stress during flowering",
            "Maintain consistent soil moisture",
            "Use raised beds to prevent waterlogging",
          ],
        },
        Potato: {
          methods: [
            {
              name: "Drip Irrigation",
              description:
                "Best for potato - maintains optimal soil moisture without waterlogging.",
              efficiency: "Very High (90-95%)",
              recommended: true,
            },
            {
              name: "Sprinkler System",
              description:
                "Good alternative for uniform coverage in potato fields.",
              efficiency: "High (75-85%)",
              recommended: true,
            },
          ],
          practices: [
            "Keep soil consistently moist but not waterlogged",
            "Critical period: Tuber initiation to bulking stage",
            "Reduce irrigation 2 weeks before harvest",
            "Avoid overhead irrigation during flowering",
          ],
        },
        Pepper: {
          methods: [
            {
              name: "Drip Irrigation",
              description:
                "Ideal for pepper - precise water delivery prevents disease.",
              efficiency: "Very High (90-95%)",
              recommended: true,
            },
          ],
          practices: [
            "Water regularly during flowering and fruiting",
            "Avoid wetting leaves to prevent fungal diseases",
            "Mulch to conserve moisture",
            "Light but frequent irrigation is better than heavy watering",
          ],
        },
        Orange: {
          methods: [
            {
              name: "Drip Irrigation",
              description:
                "Best for citrus - efficient water use and prevents root diseases.",
              efficiency: "Very High (90-95%)",
              recommended: true,
            },
            {
              name: "Micro-Sprinklers",
              description:
                "Good for larger orange orchards. Provides even coverage.",
              efficiency: "High (80-85%)",
              recommended: true,
            },
          ],
          practices: [
            "Deep watering once a week better than frequent shallow watering",
            "Critical periods: Flowering, Fruit development",
            "Reduce irrigation during fruit maturation",
            "Maintain soil moisture at 60-80% field capacity",
          ],
        },
        Grapes: {
          methods: [
            {
              name: "Drip Irrigation",
              description:
                "Perfect for vineyards - precise control over water and nutrients.",
              efficiency: "Very High (90-95%)",
              recommended: true,
            },
          ],
          practices: [
            "Deficit irrigation improves grape quality",
            "Reduce water during berry ripening for better sugar content",
            "Maintain moderate water stress for wine grapes",
            "Irrigate more during berry formation stage",
          ],
        },
        Default: {
          methods: [
            {
              name: "Drip Irrigation",
              description:
                "Most water-efficient method suitable for most crops.",
              efficiency: "Very High (90-95%)",
              recommended: true,
            },
            {
              name: "Sprinkler Irrigation",
              description: "Good for uniform coverage across large areas.",
              efficiency: "High (75-85%)",
              recommended: true,
            },
          ],
          practices: [
            "Monitor soil moisture regularly",
            "Irrigate during early morning or evening",
            "Avoid irrigation during hot afternoon",
            "Use mulching to reduce water evaporation",
          ],
        },
      };

      // Water source recommendations
      const waterSourceRecommendations = {
        River: {
          icon: "üèûÔ∏è",
          methods: ["Canal Irrigation", "Lift Irrigation", "Sprinkler System"],
          tips: "River water is abundant. Consider water storage for dry season. Check water quality periodically.",
        },
        Well: {
          icon: "üö∞",
          methods: ["Drip Irrigation", "Bucket Irrigation"],
          tips: "Well water may be limited. Use drip irrigation for maximum efficiency. Monitor water table levels.",
        },
        "Tank Channels": {
          icon: "üíß",
          methods: ["Canal Irrigation", "Gravity Flow"],
          tips: "Tank water excellent for irrigation. Check siltation levels. Clean channels regularly.",
        },
        Borewell: {
          icon: "‚öôÔ∏è",
          methods: ["Drip Irrigation", "Sprinkler System"],
          tips: "Borewell water reliable but costly. Use drip to minimize electricity costs. Test for salinity.",
        },
      };

      // Fetch farmer data
      async function loadFarmerData() {
        try {
          const res = await fetch("http://localhost:5000/farmers");
          if (!res.ok) throw new Error("Failed to fetch farmer data");

          const farmers = await res.json();
          farmerData = farmers.find((f) => f.username === username);

          if (!farmerData) {
            throw new Error("Farmer not found");
          }

          displayCropBanner(farmerData);
          displayIrrigationMethods(farmerData);
          displayWaterSourceInfo(farmerData);
          displayPractices(farmerData);
        } catch (error) {
          console.error("Error loading data:", error);
          document.getElementById("cropBanner").innerHTML = `
            <div style="color: #f44336;">
              ‚ùå Error loading data: ${error.message}
            </div>
          `;
        }
      }

      // Display crop banner
      function displayCropBanner(farmer) {
        const crop = farmer.cropChosen || "Crop";
        const landSize = farmer.landDetails?.landSize || "N/A";
        const waterSource = farmer.landDetails?.waterResource || "N/A";

        document.getElementById("cropBanner").innerHTML = `
          <h2>üíß Irrigation Plan for ${crop}</h2>
          <p>Land Size: ${landSize} acres | Water Source: ${waterSource}</p>
        `;
      }

      // Display irrigation methods
      function displayIrrigationMethods(farmer) {
        const crop = farmer.cropChosen || "Default";
        const data = irrigationData[crop] || irrigationData.Default;

        const methodsHTML = data.methods
          .map(
            (method) => `
          <div class="method-card">
            <h4>
              üí¶ ${method.name}
              ${
                method.recommended
                  ? '<span class="badge recommended">‚≠ê Recommended</span>'
                  : ""
              }
            </h4>
            <p><strong>Description:</strong> ${method.description}</p>
            <p><strong>Water Efficiency:</strong> ${method.efficiency}</p>
            <span class="badge efficient">Water Saving</span>
          </div>
        `
          )
          .join("");

        document.getElementById("methodsContent").innerHTML = methodsHTML;
      }

      // Display water source info
      function displayWaterSourceInfo(farmer) {
        const waterSource = farmer.landDetails?.waterResource || "Well";
        const sourceData =
          waterSourceRecommendations[waterSource] ||
          waterSourceRecommendations["Well"];

        document.getElementById("waterSourceContent").innerHTML = `
          <div class="water-info">
            <h4>${sourceData.icon} Your Water Source: ${waterSource}</h4>
            <p style="color: #e0e0e0; margin-bottom: 15px;">${
              sourceData.tips
            }</p>
            <p><strong style="color: #42a5f5;">Recommended Systems:</strong></p>
            <ul>
              ${sourceData.methods.map((m) => `<li>${m}</li>`).join("")}
            </ul>
          </div>
        `;
      }

      // Display crop-specific practices
      function displayPractices(farmer) {
        const crop = farmer.cropChosen || "Default";
        const data = irrigationData[crop] || irrigationData.Default;

        document.getElementById("practicesContent").innerHTML = `
          <div class="tips-box">
            <h4>üí° Best Irrigation Practices for ${crop}</h4>
            <ul>
              ${data.practices.map((p) => `<li>${p}</li>`).join("")}
            </ul>
          </div>

          <div class="tips-box" style="border-color: #ff9800; background: rgba(255, 152, 0, 0.15);">
            <h4 style="color: #ff9800;">‚ö†Ô∏è General Irrigation Guidelines</h4>
            <ul>
              <li>Always irrigate during early morning (6-8 AM) or evening (5-7 PM)</li>
              <li>Avoid irrigation during hot afternoon - high evaporation loss</li>
              <li>Check soil moisture before irrigating - use finger test or moisture meter</li>
              <li>Use mulching to reduce water evaporation by 50-70%</li>
              <li>Regular maintenance of irrigation equipment saves water and money</li>
              <li>Consider rainwater harvesting for sustainable water management</li>
            </ul>
          </div>
        `;
      }

      // Load data on page load
      loadFarmerData();
    </script>
  </body>
</html>
